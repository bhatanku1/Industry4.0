<!DOCTYPE html>
<html>
<meta charset="UTF-8">

<head>

    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/jquery.blockUI.min.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript"
            src="https://www.google.com/jsapi?autoload={
            'modules':[{
              'name':'visualization',
              'version':'1',
              'packages':['corechart']
            }]
          }"></script>
    <script type="text/javascript" src="cordova_plugins.js"></script>
    <link href="lib/ionic/css/ionic.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/wifi.css">
    <script type="text/javascript" src="js/mqttws31.js"></script>

</head>

<body onload="threshold()">
<div class="bar bar-header bar-dark">

    <a href = "mainsettings.html"><button class="button button-clear button-light ion-android-arrow-back"></button></a>
    <h1 class="title">Threshold Settings</h1>
    <a class="button button-right button-clear button-light ion-home" href = "ui.html"></a>
    <!--<a class="button button-right button-clear button-light icon-large ion-loop" href = "thresholdSettings.html"></a> -->
    <!--<button id="btn_settings" class="button button-right button-clear button-light ion-gear-a" ><a href = "settings.html"></a></button> -->

</div>

<br>
<br>
<br>

<div class="list card">

    <a href="#" class="item item-icon-left">
        <i class="icon ion-cloud" onclick="updateThresholdX()"></i>
        <h2>Enter X-moment threshold</h2>
        <p id="threshXInfo"></p>
    </a>

    <a href="#" class="item item-icon-left">
        <i class="icon ion-usb" onclick="updateThresholdY()"></i>
        <h2>Enter Y-moment threshold</h2>
        <p id="threshYInfo"></p>
    </a>

    <a href="#" class="item item-icon-left">
        <i class="icon ion-android-person" onclick="updateThresholdZ()"></i>
        <h2>Enter Z-moment threshold</h2>
        <p id="threshZInfo"></p>
    </a>

</div>

<script>

    //var len1 = 0;
    function onDeviceReady() {
	    var db = window.sqlitePlugin.openDatabase({name: "myanother.db"});
        db.transaction(function(tx) {

            // demonstrate PRAGMA:
            db.executeSql("pragma table_info (threshold_table);", [], function(res) {
                console.log("PRAGMA res: " + JSON.stringify(res));
            });

            db.transaction(function(tx) {

                tx.executeSql("select * from threshold_table;", [], function(tx, res) {
                    var len = res.rows.length;
                    //alert(len);
                    for (var i=0; i<len; i++) {
                        //document.getElementById("clist").appendChild(newParagraph);
                        document.getElementById("threshXInfo").innerHTML = res.rows.item(i).threshX
                        document.getElementById("threshYInfo").innerHTML = res.rows.item(i).threshY
                        document.getElementById("threshZInfo").innerHTML = res.rows.item(i).threshZ
                        //alert( res.rows.item(i).client_Id);
                    }
                    //alert("res.rows.length: " + res.rows.length + " -- should be 1");
                    //alert("res.rows.item(0) " + res.rows.item(0).data + " -- should be 1");
                });
            });

        },

        function() {
            // OK to close here:
            console.log('transaction ok');
            db.close(function() {
                console.log('database is closed ok');
            });
        },

        function(e) {
            console.log("ERROR: " + e.message);
            db.close();
            //});  pulaMod_fr_14:58
        });
    }


	function threshold() {
        document.addEventListener("deviceready", onDeviceReady, false);
    }

    function updateThresholdX(){

        var thresholdX=prompt("Please enter the threshold for X-moment","");
        if (thresholdX!=null) {
            var db = window.sqlitePlugin.openDatabase({name: "myanother.db"});
            db.transaction(function(tx) {
                tx.executeSql("UPDATE threshold_table SET threshX=? where id=1;", [thresholdX], function(tx, res) {
                len1 = res.rows.length;
                alert(thresholdX);
                });
            },
            function() {
                console.log('transaction ok');
                db.close(function() {
                console.log('database is closed ok');
                });
            },
            function(e) {
                console.log("ERROR: " + e.message);
                db.close();
            });
        };
    }

    function updateThresholdY(){

        var thresholdY=prompt("Please enter the threshold for Y-moment","");
        if (thresholdY!=null) {
            var db = window.sqlitePlugin.openDatabase({name: "myanother.db"});
            db.transaction(function(tx) {
                tx.executeSql("UPDATE threshold_table SET threshY=? where id=1;", [thresholdY], function(tx, res) {
                len1 = res.rows.length;
                alert(thresholdY);
                });
            },
            function() {
                console.log('transaction ok');
                db.close(function() {
                console.log('database is closed ok');
                });
            },
            function(e) {
                console.log("ERROR: " + e.message);
                db.close();
            });
        };
    }

    function updateThresholdZ(){

        var thresholdZ=prompt("Please enter the threshold for Z-moment","");
        if (thresholdZ!=null) {
            var db = window.sqlitePlugin.openDatabase({name: "myanother.db"});
            db.transaction(function(tx) {
                tx.executeSql("UPDATE threshold_table SET threshZ=? where id=1;", [thresholdZ], function(tx, res) {
                len1 = res.rows.length;
                alert(thresholdZ);
                });
            },
            function() {
                console.log('transaction ok');
                db.close(function() {
                console.log('database is closed ok');
                });
            },
            function(e) {
                console.log("ERROR: " + e.message);
                db.close();
            });
        };
    }

</script>
</body>
</html>

