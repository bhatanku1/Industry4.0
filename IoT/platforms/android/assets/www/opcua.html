<!DOCTYPE html>
<html>
<meta charset="UTF-8">

<head>
	<script type="text/javascript" src="js/mqttws31.js"></script>



</head>
<body onload="allFunction()">



<br>
<button onclick="publish('on')">
	On
</button>
<button onclick="publish('off')">
	Off
</button>

<br>


<br>
<p id="sub"></p>
<script>
			function allFunction() {
				connect(subscribe);

			}
			function publish(val) {
				message = new Paho.MQTT.Message(val);
				message.destinationName = "tum/led";
				clientPublish.send(message);

			}
			function connect(callback) {
				clientPublish = new Paho.MQTT.Client("ws://iot.eclipse.org/ws", "myClientId1" + new Date().getTime());

				clientPublish.connect({

					onSuccess : onConnect
				});
				function onConnect() {
					console.log("connection successful");
					callback();
				}

			}



			function subscribe() {

				clientPublish.onMessageArrived = onMessageArrived;
				console.log("crossed arrrival");
				console.log("Trying to subscribe");
				clientPublish.subscribe("tum/led/status");
				console.log("successfuly subscribed to the topic");
				function onConnect() {
					console.log("Trying to subscribe");
					clientPublish.subscribe("tum/led/status");
					console.log("successfuly subscribed to the topic");
				}

				// called when the client loses its connection
				function onConnectionLost(responseObject) {
					if (responseObject.errorCode !== 0) {
						console.log("onConnectionLost:" + responseObject.errorMessage);
						//setTimeout(function() { clientSubcribe.connect() }, 5000);
					}
				}

				// called when a message arrives
				function onMessageArrived(message) {
					console.log("message is received" + message.payloadString);

					if (message.payloadString == "on"){
						alert("it is on");

					}
					else{
						alert("it is off");
					}
					document.getElementById("sub").innerHTML = message.payloadString;


				}

			}
		</script>
</body>
</html>