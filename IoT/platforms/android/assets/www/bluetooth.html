<!DOCTYPE html>
<html>
<meta charset="UTF-8">

<head>

	<script type="text/javascript" src="cordova.js"></script>
	<script type="text/javascript" src="cordova_plugins.js"></script>
	<link href="lib/ionic/css/ionic.css" rel="stylesheet">


</head>
<body>
<div class="bar bar-header bar-positive">
	<h1 class="title">BLUETOOTH DEVICES</h1>
	<a href = "index.html"><button class="button button-clear button-light"><b>BACK</b></button></a>
</div>
<br>
<br>
<br>

<h3>PAIR A NEW DEVICE: ENTER THE BLUETOOTHID</h3>
<input id ="text_macid" type="text" name="sub"/>
<button id = "btn_sub" onclick="subscribe()">
	CONNECT
</button>
<br>
<h3 id="fHeader"></h3><br>
<p id = "test"></p>
<p id="sub"></p>
<div>
	History of devices paired with the device(Click to subscribe to the device)
</div>
<script>
			function onDeviceReady() {
				var bluetooth_id = document.getElementById("text_macid").value;
				var a = MqttPlugin.subscribe({topic: "$EDC/"+bluetooth_id});
            	var db = window.sqlitePlugin.openDatabase({name: "my.db"});
            	db.transaction(populateDB, errorDB, successDB);
            	db.transaction(function(tx) {
        			tx.executeSql("select macid  from device;", function(tx, res) {
       				   document.getElementById("sub").innerHTML = "res.rows.length: " + res.rows.length;

    			    });
    			  });
            }
            function populateDB(tx) {
				var mac = document.getElementById("text_macid").value;
				var typedevice = "bluetooth";
				tx.executeSql('CREATE TABLE IF NOT EXISTS device (macid text, devicetype text)');
				alert("table created");
				tx.executeSql("INSERT INTO device (macid, devicetype) VALUES ('"+ mac + "','" + typedevice + "')");


				alert("values inserted");

            }
            function errorDB(tx) {
				alert("Error: " + tx);
            }
            function successDB() {
            ;
				navigator.notification.alert("Success in DB creation",null,"Information", "OK");
            }

			function publish() {

				MqttPlugin.publish({
				topic:"$EDC/plugin",
				data:"Mqtt data"

				});
			}

			function subscribe() {
				document.addEventListener("deviceready", onDeviceReady, false);

			}






    </script>
</body>
</html>