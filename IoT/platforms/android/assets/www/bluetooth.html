<!DOCTYPE html>
<html>
<meta charset="UTF-8">

<head>

	<script type="text/javascript" src="cordova.js"></script>
	<script type="text/javascript" src="cordova_plugins.js"></script>
	<link href="lib/ionic/css/ionic.css" rel="stylesheet">


</head>
<body>
<div class="bar bar-header bar-positive">
	<h1 class="title">BLUETOOTH DEVICES</h1>
	<a href = "index.html"><button class="button button-clear button-light"><b>BACK</b></button></a>
</div>
<br>
<br>
<br>

<h3>PAIR A NEW DEVICE: ENTER THE BLUETOOTHID</h3>
<input id ="text_macid" type="text" name="sub"/>
<button id = "btn_pub" onclick="publish()">
	PUBLISH
</button><button id = "btn_sub" onclick="subscribe()">
  SUBSCRIBE
</button>
</button><button id = "btn_start" onclick="start()">
  START
</button>
</button><button id = "btn_stop" onclick="stop()">
  STOP
</button>

<br>
<h3 id="fHeader"></h3><br>
<p id = "test"></p>
<p id="sub"></p>
<div>
	History of devices paired with the device(Click to subscribe to the device)
</div>
<script>
			function onDeviceReady() {
				var db = window.sqlitePlugin.openDatabase({name: "myanother.db"});

  db.transaction(function(tx) {
    tx.executeSql('DROP TABLE IF EXISTS test_table');
    tx.executeSql('CREATE TABLE IF NOT EXISTS test_table (id integer primary key, data text, data_num integer)');

    // demonstrate PRAGMA:
    db.executeSql("pragma table_info (test_table);", [], function(res) {
      console.log("PRAGMA res: " + JSON.stringify(res));
    });
    var mac = document.getElementById("text_macid").value
    tx.executeSql("INSERT INTO test_table (data, data_num) VALUES (?,?)", [mac, 100], function(tx, res) {
      alert("insertId: " + res.insertId + " -- probably 1");
      alert("rowsAffected: " + res.rowsAffected + " -- should be 1");

      db.transaction(function(tx) {

        tx.executeSql("select * from test_table;", [], function(tx, res) {
          var len = res.rows.length;
          alert(len);
          for (var i=0; i<len; i++){
            alert( res.rows.item(i).data);
          }
          //alert("res.rows.length: " + res.rows.length + " -- should be 1");
          //alert("res.rows.item(0) " + res.rows.item(0).data + " -- should be 1");
        });
      });

    }, function(e) {
      console.log("ERROR: " + e.message);
    });
  });
}
			function publish() {

				MqttPlugin.publish({
				topic:"$EDC/tum/B8:27:EB:A6:A9:8A/BLUETOOTH-V1/GET/configurations",
				data:"Mqtt data"

				});
			}

			function start() {

				MqttPlugin.publish({
				topic:"$EDC/tum/B8:27:EB:A6:A9:8A/BLUETOOTH-V1/EXEC/start",
				data:"Mqtt data"

				});
			}
            function stop() {

				MqttPlugin.publish({
				topic:"$EDC/tum/B8:27:EB:A6:A9:8A/BLUETOOTH-V1/EXEC/stop",
				data:"Mqtt data"

				});
			}
			function subscribe() {
			    var bluetooth_id = document.getElementById("text_macid").value;
				var a = MqttPlugin.subscribe({topic: "$EDC/tum/ANKUR/BLUETOOTH-V1/REPLY/4234216342143261"});
				document.addEventListener("deviceready", onDeviceReady, false);

			}






    </script>
</body>
</html>